### 3.4 迭代四

#### 3.4.1 需求信息

参见「II. 项目需求信息」

<br/>

#### 3.4.2 分解的系统组件

选择通信机制组件进行分解，该组件负责API网关、服务集群和注册集群之间网络的传输，需要保证快速、稳定以及高并发的请求和获取服务。

<br/>

#### 3.4.3 组件负责的ASR

| 架构驱动                                 | 重要性   | 难易度   |
| --------------------------------------- | -------- | -------- |
| 场景1：\>100的用户同时购买同一场电影的票   | 高 | 高 |
| 场景10：未登录的用户进行购票操作           | 高 | 中 |
| 场景12：用户网络不稳定或失去连接           | 中 | 高 |


<br/>

#### 3.4.4 为ASR进行设计

1. **设计关注点**

| 质量属性 | 设计关注点 | 子关注点 |
| ------ | --------- | ------ |
|  性能  | 控制资源请求   | 设置任务优先级 |
| 可用性 | 检测连接状态   | 检测通信有效性 |
| 可靠性 | 保证数据完整性 | 数据校验 |
| 安全性 | 网络传输安全   | 信息加密 |

2. **关注点的候选模式**

    - 2.1. **设置任务优先级**
    
        - 2.1.1. 候选模式
        
          | # |    模式名称 | 性能 | 实时性 | 是否数据丢失 |
          | - | ------------------ | -- | -- | -- |
          | 1 | 使用优先队列处理请求 | 中 | 中 | 否 |
          | 2 | 使用队列处理请求    | 高 | 低 | 否 |
          | 3 | 忽略低优先级请求    | 高 | 高 | 是 |

        - 2.1.2. 选择的模式及理由

            选择使用优先队列来处理信息，这样可以在保证数据不会丢失的情况下仍然可以先处理高优先级的请求。虽然使用队列不会有进行排序的开销，但这样就难以对信息进行控制，不能确保最紧急的请求最优先被处理。同时，虽然忽略低优先级请求具有高效的性能，但其存在数据丢失。因此，优先队列是合理的选择。

    - 2.2. **检测通信有效性**
    
        - 2.2.1. 候选模式
        
          | # |    模式名称 | 网络负担 | 实现难度 |
          | - | ------------------ | -- | -- |
          | 1 |  心跳检测  | 中 | 中 |
          | 2 | Ping/Echo | 高 | 高 |

        - 2.2.2. 选择的模式及理由

            选择使用心跳检测。因为实现心跳检测比实现Ping/Echo要高。同时，完成一次心跳检测只需要发送一次信息，而完成一次Ping/Echo需要发送两次信息，如果使用Ping/Echo则会加大对通信负担。
    
    - 2.3. **数据校验**
    
        - 2.3.1. 候选模式
        
          | # |    模式名称 | 正确率 | 实现难度 |
          | - | ------------------ | -- | -- |
          | 1 |  奇偶校验  | 中 | 低 |
          | 2 | 循环冗余校验 | 高 | 高 |

        - 2.3.2. 选择的模式及理由

            选择使用奇偶校验。循环冗余校验之所以能带来高准确率是因为它有更多的校验位，这会增加链路负担，而且对网络传输的数据也只需要进行基本的校验，循环冗余校验的高准确率超过了系统的需要。因此在能满足数据可靠性的情况下，成本较低的奇偶校验是更优的选择。
    
    - 2.4. **信息加密**
    
        - 2.4.1. 候选模式
        
          | # |  模式名称 | 性能 | 安全性 | 实现难度 |
          | - | ------------------ | -- | -- | -- |
          | 1 | 使用SSL/TSL进行加密 | 高 | 高 | 低 |
          | 2 | 使用AES认证机制 | 中 | 高 | 高 |

        - 2.4.2. 选择的模式及理由

          选择使用SSL/TSL进行加密。因为SSL/TLS被广泛用于数据加密中。不仅如此，SSL/TLS被大多数设备所支持，并且实现该机制的成本更低。


2. **候选模式与对应ASR**

| 模式类型     | 选择的模式         | 架构驱动      |
| ------------ | ------------------ | ------------- |
| 设置任务优先级 | 使用优先队列处理请求 | 场景1  |
| 检测通信有效性 | 心跳检测            | 场景12 |
|    数据校验   | 奇偶校验             | 场景1 |
|    信息加密   | 使用SSL/TSL进行加密  | 场景10 |

<br/>

#### 3.4.5 架构视图

1. **C&C视图**

![](pics/3.4.5-C&C视图.png)

2. **Module视图**

![](pics/3.4.5-Module视图.png)

<br/>

#### 3.1.6 评估

此次没有发现矛盾