#### 3.2.4 为ASR进行设计

1. **设计关注点**
   
| 质量属性 | 设计关注点 | 子关注点 |
| ------ | --------- | ------ |
| 可用性   | 服务器宕机处理  | 服务器备份 |
|        |           | 服务器状态监控 |
|        |           | 服务器恢复 | 

2. **关注的候选模式**
   
   - **服务器备份**

     | # | 候选模式名称 | 性能 | 开销 | 是否可能产生服务丢失 |
     | --|--------- | ------ | ------ |  -- |
     | 1 | 对数据进行完全备份 | 低 | 高 | 否 |
     | 2 | 双机热备份 | 中 | 高 | 否 |
     | 3 | 双机互备份 | 中 | 中 | 一般不会 |
     | 4 | 双机双工 | 高 | 中 | 一般不会 | 

     - 选择的模式及理由

       选择使用双机双工模式，因为如果每天对数据进行完全备份会消耗大量的硬件和存储资源，同时需要专门的时间进行备份，性能较低；而双机热备份和双机互备份同时只运行一台机器，有一定的硬件性能的浪费，同时双机互备份要求在一台机器在另一台机器出现问题时立刻接管故障服务器的应用，对服务器的性能要求较高；而双机双工模式中，两台服务器均为活动，同时运行相同的应用，新跟那个较高，同时实现了负载均衡，且不易产生服务丢失，效果较好，从而选择使用双机双工模式。

   - **服务器状态监控**
  
     | # | 候选模式名称 | 时延 | 资源消耗 | 监控程度 |
     | --|--------- | ------ | ------ | -- | 
     | 1 | Heartbeat模式 | 低 | 中 | 高 |
     | 2 | Ping/Echo | 中 | 低 | 中 |

     - 选择的模式及理由

       选择Ping/Echo模式，因为在分布式环境下，服务节点一般会很多，所以根据概率而言，宕机少部分服务器对用户和整个系统的服务而言一般影响不大；其次监控中心需要对大量的服务器进行监控，所以资源消耗对监控模块而言至关重要，所以选择资源消耗较低的Ping/Echo模式对服务器进行监控。

   - **服务器恢复**

     | # | 候选模式名称 | 成功率 | 不可用时间 | 故障排查率 |
     | --|--------- | ------ | ------ | -- | 
     | 1 | 记录错误信息，服务自启动 | 低 | 短 | 低 |
     | 2 | 设置checkpoint，等待手动启动 | 高 | 长 | 高 |

     - 选择的模式及理由

       在分布式的环境下，一台或少数服务器的宕机不会影响整个系统的工作，但是对服务器状况和错误的了解及修正是十分重要的，这可以让我们了解系统的工作状况和发生错误的上下文条件，所以选择设置checkpoint，等待手动启动。