|      | 质量属性              | 具体属性     | 场景                                                         |
| ---- | --------------------- | ------------ | ------------------------------------------------------------ |
| 1    | 可用性Availability    | 失败恢复     | A1: 对方节点未离线，心跳监控器未收到响应时，要在3s内重连成功(H,M) |
| 2    |                       | 失败处理     | A2: 对方节点已经离线，心跳监控器未收到响应，要在3s内切断连接并保存状态(M,M) |
| 3    |                       | 消息获取速度 | A3: 节点重新登录后，离线消息要在20s内获得(H,H)               |
| 4    |                       | 连接可用     | A4: 群聊中节点离线，其余网络节点仍然可以相互通信(H,H)        |
| 10   |                       | 连接可用     | A5: 与内部网络中节点建立连接的成功率为99.99%(H,H)            |
| 8    | 安全性Security        | 消息加密     | A6: 消息被截获后，如果对方不能获得私钥，消息被破解率为0%     |
| 6    | 性能Performance       | 消息延迟     | A7: 点对点消息发送后，对方要在3s内收到消息(H,H)              |
| 7    |                       |              | A8: 群聊消息发送后，群聊中每个人要在5s内接收到消息(H,H)      |
| 5    | 可修改性Modifiability | 代码修改     | A9: 核心代码修改率为0%                                       |
| 9    | 可测试性Testability   | 错误发现     | A10: 代码中80%的错误可以在3个小时内找出                      |

| Scenario A4 | 群聊中节点离线，其余网络节点仍然可以相互通信(H,H)            |
| ----------- | ------------------------------------------------------------ |
| 质量属性    | 可用性                                                       |
| 环境        | 群聊中有节点已离线                                           |
| 刺激        | 群聊中有节点发生异常或者退出群聊                             |
| 响应        | 其他群聊中的节点相应交换状态并建立新的连接                   |
| 架构决策    | 使用Ping / echo发现节点的状态变化<br />敏感点：S1<br />权衡点：T1<br />有风险决策：R1<br /> |
| 理由        | 定位仅仅发生在聊天开始的时候，使用频率较低，虽然heartbeat性能更好，但是没有必要，因此选择Ping/echo |
| 架构图      |                                                              |

| Scenario A5 | 与内部网络中节点建立连接的成功率为99.99%(H,H)                |
| ----------- | ------------------------------------------------------------ |
| 质量属性    | 可用性                                                       |
| 环境        | 系统正常工作中                                               |
| 刺激        | 对等节点在内网中                                             |
| 响应        | 尝试去连接内部网络中的节点                                   |
| 架构决策    | 反向代理<br />敏感点：S2<br />权衡点：T2<br />无风险决策：N1<br /> |
| 理由        | 系统要允许内网节点和外网节点进行通信。使用反向代理方法，在内网和外网间增加额外的代理节点，可以在较少的开发成本下，实现内网穿透。 |
| 架构图      |                                                              |





敏感点列表

| 编号 | 架构决策                          | 理由                                                         |
| ---- | --------------------------------- | ------------------------------------------------------------ |
| S1   | 使用Ping / echo发现节点的状态变化 | 对于性能和可用性是敏感点。Ping/echo提高了可用性，但是会造成节点的性能负担。 |
| S2   | 反向代理                          | 对于可用性、性能和安全性是敏感点。反向代理提高了可用性，但是代理节点会成为性能瓶颈，也会成为攻击目标。 |

权衡点列表

| 编号 | 架构决策                          | 理由                                                       |
| ---- | --------------------------------- | ---------------------------------------------------------- |
| T1   | 使用Ping / echo发现节点的状态变化 | 在性能和可用性之间做了权衡。提高了可用性，但降低了性能。   |
| T2   | 反向代理                          | 在开发成本和性能之间做了权衡，减少了开发成本，降低了性能。 |

有风险决策列表

| 编号 | 架构决策                          | 理由                        |
| ---- | --------------------------------- | --------------------------- |
| R1   | 使用Ping / echo发现节点的状态变化 | 需要发送两次请求，可能会造成网络拥堵，影响通信，降低性能 |

无风险决策列表

| 编号 | 架构决策 | 理由                                 |
| ---- | -------- | ------------------------------------ |
| N1   | 反向代理 | 反向代理是一种广泛使用的内网穿透技术 |

