| 场景A1, A2 | 对方节点未离线，心跳监控器未收到响应时，要在3s内重连成功<br/>对方节点已离线，心跳监控器未收到响应时，要在3s内切断连接并保存状态 |
| ---------- | ------------------------------------------------------------ |
| 质量属性   | 可用性                                                       |
| 环境       | 运行时                                                       |
| 刺激       | 没有收到对方节点的响应                                       |
| 响应       | 尝试重新连接（连接成功或作出对方已下线的判断）               |
| 架构决策   | UDP<br/>Heartbeat                                            |
| 理由说明   | 可用性是该系统设计中着重点关注的质量属性，节点之间互相通信从而保持状态的同步是系统可用的前提条件。心跳监控器可能会因为一些不可控的原因未收到响应，这时需要能够及时恢复，优先级很高。为了保障这一点，值得采用高性能成本的措施（Heartbeat）。同时为了控制资源大小，采用更轻便传输协议标准。 |



| 场景A3   | 节点重新登录后，离线消息要在20s内获得                        |
| -------- | ------------------------------------------------------------ |
| 质量属性 | 可用性                                                       |
| 环境     | 运行时                                                       |
| 刺激     | 重新登录                                                     |
| 响应     | 尝试获取离线信息                                             |
| 架构决策 | UDP                                                          |
| 理由说明 | 在离线状态下，系统仍应该保持可用性。为了能够使用户上线后尽快获取离线消息，选择更轻便的传输协议标准 |



| 场景A6   | 消息被截获后，如果对方不能获得私钥，消息被破解率为0%         |
| -------- | ------------------------------------------------------------ |
| 质量属性 | 安全性                                                       |
| 环境     | 运行时                                                       |
| 刺激     | 消息被截获                                                   |
| 响应     | 在不具备私钥的情况下，消息内容不能被破解                     |
| 架构决策 | 密钥加密                                                     |
| 理由说明 | 对用户隐私的保护是p2p这样去中心化架构的优势所在，系统需要对用户信息加密，防止不相关人等看到。在网络通信中截获数据包相对容易，这时便需要通过加密保护用户的信息安全。 |





敏感点：

UDP：聊天应用中信息传输是核心，对传输协议的选择是可用性和性能的敏感点。

Heartbeats：在p2p环境下，节点之间需要状态的同步，这才能保证系统正常运行，是可用性的敏感点。

密钥加密：有效保护信息安全，是安全性的敏感点。



权衡点

UDP：UDP协议本身只能提供数据的不可靠传递，但是更灵活，资源成本更低。
heartbeats：节点之间以心跳包的方式不断交换信息，给节点带来额外的计算需要，但是可以提高可用性。



风险
UDP：可能因为掉包率过高，导致需要手动实现重发等机制，增加编程实现难度，且最终效率并不高。
heartbeats：占用过多资源，导致性能低下。

非风险
密钥加密：这是保护用户数据安全的必要措施
